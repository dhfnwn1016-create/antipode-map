<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸŒ ì§€êµ¬ ë°˜ëŒ€í¸ ì¢Œí‘œ ê³„ì‚°ê¸°</title>

    <script src="https://unpkg.com/three"></script>
    <script src="https://unpkg.com/globe.gl"></script>

    <style>
        /* CSSëŠ” ë³€ê²½ì‚¬í•­ ì—†ìŠµë‹ˆë‹¤. */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 40px;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 600px; 
            width: 100%;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 25px;
        }
        #findLocationButton {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            box-shadow: 0 4px #2980b9;
            margin-bottom: 20px;
        }
        #findLocationButton:hover {
            background-color: #2980b9;
        }
        #findLocationButton:active {
            transform: translateY(2px);
            box-shadow: 0 2px #2980b9;
        }
        #status {
            color: #34495e;
            font-size: 1.05em;
            margin-bottom: 15px;
        }
        #currentLocation, #antipodeLocation {
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            font-size: 1.05em;
        }
        #currentLocation {
            background-color: #e8f8f5;
            border-left: 5px solid #1abc9c;
        }
        #antipodeLocation {
            background-color: #f8f9fa;
            border-left: 5px solid #e74c3c;
        }
        #globeViz {
            width: 100%;
            height: 400px;
            border-radius: 8px;
            border: 1px solid #ccc;
            margin-top: 20px;
            background-color: #00002a; 
        }
        .lang-select {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }
        .lang-button {
            padding: 12px 25px;
            font-size: 1.1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
            color: white;
            font-weight: bold;
            box-shadow: 0 4px rgba(0,0,0,0.2);
            width: 180px;
        }
        .ko-btn { background-color: #27ae60; }
        .ko-btn:hover { background-color: #1e8449; }
        .en-btn { background-color: #2980b9; }
        .en-btn:hover { background-color: #21618c; }

        /* [ì¶”ê°€ë¨] êµ¬ê¸€ë§µ ë§í¬ ìŠ¤íƒ€ì¼ */
        .gmaps-link {
            display: inline-block;
            margin-top: 10px;
            font-size: 0.9em;
            color: #2980b9;
            text-decoration: none;
            font-weight: bold;
        }
        .gmaps-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
<button id="langReset" style="position:absolute; top:20px; right:20px; background:none; border:none; font-size:2.5em; cursor:pointer;">ğŸŒ</button>
  <div class="container" id="langContainer">
    <h1>ğŸŒ ì§€êµ¬ ë°˜ëŒ€í¸ ì¢Œí‘œ ê³„ì‚°ê¸°</h1>
    <p style="color:#555; margin-top:-10px; margin-bottom:20px; font-size:0.95em;">Language / ì–¸ì–´ ì„ íƒ</p>
    <div class="lang-select">
      <button class="lang-button ko-btn" onclick="setLanguage('ko')">í•œêµ­ì–´ ğŸ‡°ğŸ‡·</button>
      <button class="lang-button en-btn" onclick="setLanguage('en')">English ğŸ‡ºğŸ‡¸</button>
    </div>
  </div>

  <div class="container" id="mainContainer" style="display:none;">
    <h1 id="titleText"></h1>
    <button id="findLocationButton"></button>
    <p id="status"></p>
    <div id="currentLocation"></div>
    <div id="antipodeLocation"></div>
    
    <div id="globeViz"></div>
  </div>

  <script>
    // [ìˆ˜ì •ë¨] í…ìŠ¤íŠ¸ ê°ì²´ì— êµ¬ê¸€ë§µ ë§í¬ ì¶”ê°€
    const text = {
      ko: {
        title: "ğŸŒ ì§€êµ¬ ë°˜ëŒ€í¸ ì¢Œí‘œ ê³„ì‚°ê¸°",
        button: "âœ… í˜„ì¬ ìœ„ì¹˜ë¡œ ê³„ì‚°í•˜ê¸°",
        waiting: "ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ í˜„ì¬ ì¢Œí‘œì™€ ì§€êµ¬ ë°˜ëŒ€í¸ ì¢Œí‘œê°€ í‘œì‹œë©ë‹ˆë‹¤.",
        loading: "ğŸ“¡ ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...",
        done: "âœ… ìœ„ì¹˜ ê³„ì‚° ì™„ë£Œ",
        current: "ğŸ“ <b>í˜„ì¬ ìœ„ì¹˜</b>",
        antipode: "ğŸ¯ <b>ì§€êµ¬ ë°˜ëŒ€í¸</b>",
        lat: "ìœ„ë„",
        lon: "ê²½ë„",
        gmapsLink: "ğŸ—ºï¸ Google Mapsì—ì„œ ë³´ê¸°", // ì¶”ê°€
        error: {
          1: "âŒ ìœ„ì¹˜ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.",
          2: "âŒ ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
          3: "âŒ ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.",
          default: "âŒ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
        }
      },
      en: {
        title: "ğŸŒ 3D Antipode Coordinate Calculator",
        button: "âœ… Calculate using my location",
        waiting: "Press the button to show your location and antipode coordinates.",
        loading: "ğŸ“¡ Getting location information...",
        done: "âœ… Location retrieved successfully",
        current: "ğŸ“ <b>Your Location</b>",
        antipode: "ğŸ¯ <b>Antipode</b>",
        lat: "Latitude",
        lon: "Longitude",
        gmapsLink: "ğŸ—ºï¸ View on Google Maps", // ì¶”ê°€
        error: {
          1: "âŒ Location access denied.",
          2: "âŒ Location unavailable.",
          3: "âŒ Request timed out.",
          default: "âŒ Unknown error occurred."
        }
      }
    };
    
    let myGlobe = null;
    let globeAnimationTimeout = null; 

    function setLanguage(lang) {
      localStorage.setItem("lang", lang);
      document.getElementById("langContainer").style.display = "none";
      document.getElementById("mainContainer").style.display = "block";
      initUI();
    }

    function initUI() {
      const lang = localStorage.getItem("lang") || "ko";
      const t = text[lang];
      document.getElementById("titleText").innerHTML = t.title;
      document.getElementById("findLocationButton").textContent = t.button;
      document.getElementById("status").textContent = t.waiting;

      const btn = document.getElementById("findLocationButton");
      btn.onclick = () => {
        document.getElementById("status").textContent = t.loading;
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (pos) => showPosition(pos, t),
            (err) => showError(err, t),
            { enableHighAccuracy: true, timeout: 7000, maximumAge: 0 }
          );
        } else {
          document.getElementById("status").textContent = "âŒ Geolocation not supported.";
        }
      };
      
      initGlobe();
    }

    function calculateAntipode(lat, lon) {
      const antipodeLat = -lat;
      let antipodeLon = lon + 180;
      if (antipodeLon > 180) antipodeLon -= 360;
      return { lat: antipodeLat, lon: antipodeLon };
    }

    // [ìˆ˜ì •ë¨] displayResults í•¨ìˆ˜ì— êµ¬ê¸€ë§µ ë§í¬ ìƒì„± ë¡œì§ ì¶”ê°€
    function displayResults(cLat, cLon, aLat, aLon, t) {
      document.getElementById("status").textContent = t.done;

      // êµ¬ê¸€ë§µ URL ìƒì„±
      const currentGmapsUrl = `https://www.google.com/maps?q=${cLat},${cLon}`;
      const antipodeGmapsUrl = `https://www.google.com/maps?q=${aLat},${aLon}`;

      document.getElementById("currentLocation").innerHTML = `
        <p>${t.current}</p>
        <p>${t.lat}: ${cLat.toFixed(4)}Â°, ${t.lon}: ${cLon.toFixed(4)}Â°</p>
        <a href="${currentGmapsUrl}" target="_blank" class="gmaps-link">${t.gmapsLink}</a>
      `;
      document.getElementById("antipodeLocation").innerHTML = `
        <p>${t.antipode}</p>
        <p>${t.lat}: ${aLat.toFixed(4)}Â°, ${t.lon}: ${aLon.toFixed(4)}Â°</p>
        <a href="${antipodeGmapsUrl}" target="_blank" class="gmaps-link">${t.gmapsLink}</a>
      `;
      
      updateGlobe(cLat, cLon, aLat, aLon);
    }
    
    function initGlobe() {
        const globeEl = document.getElementById('globeViz');
        const width = globeEl.clientWidth;
        const height = globeEl.clientHeight;

        myGlobe = Globe()
          (globeEl)
          .width(width)
          .height(height)
          .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg') 
          .backgroundColor('rgba(0,0,0,0)');
    }
    
    function updateGlobe(cLat, cLon, aLat, aLon) {
        const locations = [
            { lat: cLat, lng: cLon, name: 'í˜„ì¬ ìœ„ì¹˜', color: '#1abc9c' },
            { lat: aLat, lng: aLon, name: 'ì§€êµ¬ ë°˜ëŒ€í¸', color: '#e74c3c' }
        ];

        myGlobe
            .pointsData(locations)
            .pointLabel('name')
            .pointLat('lat')
            .pointLng('lng')
            .pointRadius(0.5)
            .pointColor('color')
            
            .pathsData([
                {
                    path: [ [cLat, cLon], [aLat, aLon] ],
                    color: '#FFA500' 
                }
            ])
            .pathPoints('path') 
            .pathColor(d => d.color) 
            .pathStroke(0.5) 
            ;

        if (globeAnimationTimeout) {
            clearTimeout(globeAnimationTimeout);
        }
        myGlobe.pointOfView({ lat: cLat, lng: cLon, altitude: 2.5 }, 1500);
        globeAnimationTimeout = setTimeout(() => {
            myGlobe.pointOfView({ lat: aLat, lng: aLon, altitude: 2.5 }, 1500);
            globeAnimationTimeout = null;
        }, 2000);
    }

    function showPosition(position, t) {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;
      const antipode = calculateAntipode(lat, lon);
      displayResults(lat, lon, antipode.lat, antipode.lon, t);
    }

    function showError(error, t) {
      const msg = t.error[error.code] || t.error.default;
      document.getElementById("status").textContent = msg;
    }

    window.onload = () => {
        document.getElementById("langContainer").style.display = "block";
        document.getElementById("mainContainer").style.display = "none";
    };
    document.getElementById("langReset").onclick = () => {
        localStorage.removeItem("lang");
        location.reload();
    };
  </script>
</body>
</html>
